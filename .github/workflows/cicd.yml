name: deploy staging webapp

on:
  push:
    branches:
      - dev

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Install dependencies
        run: |
          npm install

      - name: Build
        run: |
          npm run build

      - name: Deploy project nextjs
        env:
          SERVERID: ${{ vars.SERVERID }}
          PASS: ${{vars.PASS}}
          GIT_PASS: ${{vars.GIT_PASS}}
        run: |
          sudo apt-get install -y openssh-client
          sudo apt-get install sshpass
          echo "Deploying ..."
          sshpass -p $PASS ssh -o StrictHostKeyChecking=no root@$SERVERID "cd ../saas-web-app/ && git pull origin dev && npm install && npm run build && pm2 restart saas-web-app"
          echo "All Done !!!"
